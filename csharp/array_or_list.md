# Array or List

> 本文只讨论一维数组和列表，不讨论其他集合类型。

**简单来说，`Array`读写性能更好，`List`使用起来更灵活。**

## 具体差别：

* `Array`是一段连续的内存（连续内存带来的好处是索引更快，只需要根据地址偏移即可），`List`不一定连续，所以`Array`索引起来更快，相应的读写和遍历性能更好。
* `Array`一旦创建则不可变更长度（一些修改长度的方式其实都是创建了新数组，如`Array.Resize`），而`List`可以很方便地增删元素。

考虑到性能和便利性不可兼得，所以`Array`和`List`都有合适的使用机会。

## 什么时候用`Array`

* 对性能要求高的数据集合，如一帧进行大量读写操作的情况。
* 可以一次创建好，然后长度不会变的数据集合，如一副牌54张、底牌3张等。
* `public`方法的参数，当参数只是用来遍历或者随机索引的时候，之所以限定`public`，是因为`private`等专用方法应该根据调用方提供的类型决定参数类型，省去一步转化，如下代码：
```C#
public static void Main()
{
    List<int> list = new() { 1, 2 };
    LogAll(list);
    // LogAll(list.ToArray()); 没必要多一步转化（实际上并不会报错）
}

// LogAll接受List而不是Array，避免转化
private static void LogAll(IList<int> list)
{
    foreach (var item in list)
    {
        Console.WriteLine(item);
    }
}
```
而`public`方法并不知道调用方准备了什么样的数据，所以应该尽量保证自己的性能。

> 当然，如果全是自己写的代码，调用方全部准备的是`List`，参数肯定也用`List`了。

> `public`方法的返回值应该返回原始数据的类型，需要转化的话是调用方的事。

## 什么时候用`List`

除上面列出的情况外都可以用`List`，其实核心点还是在于方便进行增删操作，大部分情况只要涉及这一点，都应该使用`List`。

## 结论

一个项目中，`Array`和`List`基本上都会同时使用，两者并不能互相取代。

什么时候应该用哪个，可以使用最简单的判断方式：长度不变则用`Array`，否则用`List`。
